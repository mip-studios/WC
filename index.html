<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>WC - Workout Challenge</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="WC">
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAf5JREFUaEPtmO1RAzEMhGMXYBTgKOAowCnAKMAowCnAKMAowCiAAuL5JHvptD5I0qT0Sb5kS2p/d/b3fQBeALsAewB7gB3ACeAB8AY4AzwDngAssAecAS7AExiB/xN4AuwD7AGeATOAPcAG8AR4ArQAfh8ALgeQ1wHkegA5fQE8fQEkfQEsfQFYfQFYfQHkegA5XQEEfQEEfQGcfQFcfQEkfQEkfQGcfQHkegA5nQEEfQFEfQFEfQHcfQFkfQEkfQHcfQGkegA5/QE8fQEkfQFcfQHEegA5vQGcfQHEegA5vQGcfQHEegA5XQEEfQFEfQGEegA5vQGcfQHEegA5vQGEegA5vQGcfQHEegA5XQEEfQFEfQGEegA5vQGcfQHEegA5vQGkegA5/QFkfQGcfQHEegA5/QGcfQHEegA5/QGcfQHEegA5vQGEegA5vQGcfQHEegA5vQGEegA5vQGcfQHEegA5XQEEfQFEfQGkegA5vQGcfQHEegA5XQGkfQEkfQHkegA5/QGcfQFkfQGcfQHEegA5vQGcfQGkfQGEegA5vQGkfQEkfQHkegA5vQGcfQHEegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QFk/gD+8Y+4A4kX/zG/3wA2gBfAG+AC8AX4A/yr/A+MAFYAzwBngBvAF+AN8AY4A3wBngCfgT/K5wDYP8wD4A3wBjgD/Gv8DwACWAKbAQ4A5wBngDPAucAd4A5wB3gB3gDvgD/An+F/iP88a8A0wB3gD3AHOAO8AewB7gB3gDnAHeAPcAY7APgDJL/8B63AZz2VsjBwAAAAASUVORK5CYII=">

  <style>
    :root {
      --bg-color: #f2f2f2;
      --text-color: #333;
      --card-bg-color: white;
      --card-shadow: 0 2px 5px rgba(0,0,0,0.1);
      --completed-day-color: #28a745;
      --button-primary-bg: #007bff;
      --button-primary-hover-bg: #0056b3;
      --button-tertiary-bg: #6c757d;
      --button-tertiary-hover-bg: #5a6268;
      --button-danger-bg: #dc3545;
      --button-danger-hover-bg: #c82333;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #121212;
        --text-color: #e0e0e0;
        --card-bg-color: #1e1e1e;
        --card-shadow: 0 2px 8px rgba(0,0,0,0.4);
        --completed-day-color: #3b8e4e;
        --button-primary-bg: #0059b3;
        --button-primary-hover-bg: #00448a;
        --button-tertiary-bg: #4f565c;
        --button-tertiary-hover-bg: #3a4045;
        --button-danger-bg: #c82333;
        --button-danger-hover-bg: #a71d2a;
      }
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-color); color: var(--text-color); padding: 10px; margin: 0; }
    h1, h2, h3 { text-align: center; }
    h1 { font-size: 1.6em; margin: 5px 0; }
    h2.welcome-message { font-size: 1.2em; font-weight: normal; margin: 0 0 20px; }
    footer { text-align: center; margin: 30px 0 20px; font-size: 0.8em; color: var(--text-color); opacity: 0.6; }
    .intro-text { text-align: center; font-size: 0.95em; max-width: 600px; margin: 0 auto 20px; opacity: 0.8; }
    .warning { text-align: center; font-size: 0.95em; color: #b33; margin-bottom: 5px; font-style: italic; }
    
    /* Setup Wizard Styling */
    .setup-container { padding: 20px; max-width: 500px; margin: auto; }
    .setup-step { background: var(--card-bg-color); padding: 25px; border-radius: 12px; box-shadow: var(--card-shadow); margin-bottom: 20px; }
    .setup-step h3 { margin-top: 0; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    input[type="text"], input[type="number"] { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ccc; box-sizing: border-box; font-size: 1em; }
    .btn { display: inline-block; width: 100%; text-align:center; padding: 12px 16px; font-size: 1em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; color: white; background-color: var(--button-primary-bg); text-decoration: none; }
    .btn:hover { background-color: var(--button-primary-hover-bg); }
    .checkbox-group label, .radio-group label { display: flex; align-items: center; margin-bottom: 10px; }
    .checkbox-group input, .radio-group input { margin-right: 10px; transform: scale(1.3); }
    .radio-group-vertical label { margin-bottom: 15px; }
    .radio-group-vertical small { display: block; font-weight: normal; opacity: 0.8; margin-left: 28px; margin-top: -10px; }
    .progression-input-group { display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center; margin-bottom:10px;}
    .progression-input-group label { grid-column: 1 / -1; }
    .progression-input-group input { width: 80px; text-align: center; }

    /* App View Styling */
    .app-controls { text-align: center; margin-top: 20px; }
    .button-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    .feedback-button { background-color: var(--button-primary-bg); }
    .reset-button { background-color: var(--button-danger-bg); }
    
    /* Kalender Styling */
    #calendar-view { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; padding: 10px; max-width: 500px; margin: 20px auto; }
    .calendar-day { display: flex; flex-direction: column; justify-content: center; align-items: center; background: var(--card-bg-color); color: var(--text-color); text-decoration: none; font-weight: bold; font-size: 1.5em; height: 60px; border-radius: 10px; box-shadow: var(--card-shadow); }
    .calendar-day.completed { background-color: var(--completed-day-color); color: white; }
    .calendar-day.rest-day { font-size: 1em; font-style: italic; opacity: 0.8; }
    
    /* Detail Pagina Styling */
    .day-detail-card { background: var(--card-bg-color); border-radius: 12px; padding: 15px 20px; margin: 10px auto; box-shadow: var(--card-shadow); max-width: 600px; }
    .day-detail-card.completed { background-color: #d4edda; }
    .day-content { line-height: 1.6; }
    .day-content > strong { font-size: 1.2em; display:block; text-align:center; margin-bottom: 10px;}
    .day-content ul { list-style: none; padding-left: 0; }
    .day-content li { margin-bottom: 10px; font-size: 1.1em; }
    .back-button { display: block; max-width: 600px; margin: 20px auto 10px; text-align: center; color: var(--text-color); text-decoration: none; font-weight: bold; padding: 10px; background: var(--card-bg-color); border-radius: 8px; box-shadow: var(--card-shadow); }
    .complete-button { background-color: var(--button-tertiary-bg); color: white; margin-top: 15px; }
    .complete-button.done { background-color: #28a745; }
    .workout-modus-btn { background-color: #fff799; color: #333; margin-bottom: 15px; }
    .timer-button { background-color: var(--button-primary-bg); color: white; padding: 5px 10px; font-size: 0.8em; border-radius: 6px; cursor: pointer; margin-left: 10px; border: none; }
    .timer { display: inline-block; margin-left: 10px; font-weight: bold; }
  </style>
</head>
<body>
  <h1>WC - Workout Challenge</h1>
  <div class="warning">⚠️ Dit is een persoonlijke tool – niet bedoeld als medisch advies.</div>
  <p class="intro-text">Stel je eigen workout challenge samen en hou je voortgang bij!</p>
  
  <div id="app-container" style="display: none;">
      <h2 class="welcome-message"></h2>
      <main id="view-container">
          <div id="calendar-view"></div>
          <div id="detail-view" style="display: none;"></div>
      </main>
      <div class="app-controls" id="app-controls">
          <div class="button-group">
            <a href="mailto:post.master@me.com?subject=Feedback%20voor%20WC%20App" class="btn feedback-button">Geef Feedback</a>
            <button id="reset-btn" class="btn reset-button">Nieuwe Challenge</button>
          </div>
      </div>
  </div>

  <div id="setup-container" style="display: none;">
      <div class="setup-step" id="name-step">
          <h3>Welkom!</h3>
          <div class="form-group"><label for="user-name">Wat is je naam?</label><input type="text" id="user-name" placeholder="Jouw naam"></div>
          <button id="name-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="duration-step" style="display: none;">
          <h3>Challenge Duur</h3>
          <div class="form-group"><label for="challenge-duration">Hoeveel dagen duurt je challenge?</label><input type="number" id="challenge-duration" value="30" min="1"></div>
          <button id="duration-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="rest-day-step" style="display: none;">
          <h3>Rustdagen</h3>
          <div class="form-group"><label for="rest-day-interval">Neem elke hoeveelste dag een rustdag?</label><input type="number" id="rest-day-interval" value="5" min="0"></div>
          <p style="font-size:0.9em; opacity:0.7;">(Zet op 0 voor geen automatische rustdagen)</p>
          <button id="rest-day-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="exercise-step" style="display: none;">
          <h3>Kies je Oefeningen</h3>
          <div class="form-group checkbox-group" id="default-exercises">
              <label><input type="checkbox" data-type="timed" value="Plank"> Plank</label>
              <label><input type="checkbox" data-type="reps" value="Crunches"> Crunches</label>
              <label><input type="checkbox" data-type="reps" value="Leg Raises"> Leg Raises</label>
              <label><input type="checkbox" data-type="reps" value="Squats"> Squats</label>
          </div>
          <hr>
          <div class="form-group">
              <label for="custom-exercise">Voeg een eigen oefening toe:</label><input type="text" id="custom-exercise" placeholder="Bijv. Push-ups">
              <div class="form-group radio-group" style="margin-top:10px;"><label><input type="radio" name="custom-type" value="reps" checked> Aantal</label><label><input type="radio" name="custom-type" value="timed"> Seconden</label></div>
              <button id="add-exercise-btn" class="btn" style="width: auto; padding: 8px 12px; margin-top: 5px;">Voeg toe</button>
          </div>
          <button id="exercise-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="progression-step" style="display:none;">
          <h3>Stel je Doelen in</h3>
          <p style="font-size:0.9em; opacity:0.7;">De app berekent een slimme opbouw voor je.</p>
          <div id="progression-inputs"></div>
          <button id="progression-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="style-step" style="display:none;">
          <h3>Kies je Opbouw Stijl</h3>
          <div class="form-group radio-group-vertical">
              <label><input type="radio" name="progression-style" value="gemiddeld" checked> Gemiddeld<small>Een gebalanceerde S-curve opbouw.</small></label>
              <label><input type="radio" name="progression-style" value="rustig"> Rustige Start<small>Langzaam beginnen, de grootste stappen komen later.</small></label>
              <label><input type="radio" name="progression-style" value="snel"> Snelle Start<small>Direct een flinke stijging, vlakt af naar het einde.</small></label>
          </div>
          <button id="finish-setup" class="btn">Start mijn Challenge!</button>
      </div>
  </div>
  
  <footer>Mip Studio’s • 2025</footer>
  <audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    let config = {};
    let challengeData = [];
    let wakeLock = null;

    const appContainer = document.getElementById('app-container');
    const setupContainer = document.getElementById('setup-container');
    const allSteps = document.querySelectorAll('.setup-step');
    const calendarView = document.getElementById('calendar-view');
    const detailView = document.getElementById('detail-view');
    const appControls = document.getElementById('app-controls');

    function showStep(stepId) {
        allSteps.forEach(s => s.style.display = 'none');
        document.getElementById(stepId).style.display = 'block';
    }
    
    // --- SETUP WIZARD EVENT LISTENERS ---
    document.getElementById('name-submit').addEventListener('click', () => {
        const nameInput = document.getElementById('user-name');
        if (!nameInput.value.trim()) { alert('Vul alsjeblieft je naam in.'); return; }
        config.userName = nameInput.value.trim();
        showStep('duration-step');
    });
    document.getElementById('duration-submit').addEventListener('click', () => {
        config.duration = parseInt(document.getElementById('challenge-duration').value, 10) || 30;
        showStep('rest-day-step');
    });
    document.getElementById('rest-day-submit').addEventListener('click', () => {
        config.restDayInterval = parseInt(document.getElementById('rest-day-interval').value, 10);
        showStep('exercise-step');
    });
    document.getElementById('add-exercise-btn').addEventListener('click', () => {
        const customInput = document.getElementById('custom-exercise');
        const name = customInput.value.trim();
        const type = document.querySelector('input[name="custom-type"]:checked').value;
        if (name) {
            const container = document.getElementById('default-exercises');
            const label = document.createElement('label');
            label.innerHTML = `<input type="checkbox" data-type="${type}" value="${name}" checked> ${name}`;
            container.appendChild(label);
            customInput.value = '';
        }
    });
    document.getElementById('exercise-submit').addEventListener('click', () => {
        const selected = document.querySelectorAll('#default-exercises input:checked');
        if (selected.length === 0) { alert('Kies minstens één oefening.'); return; }
        config.exercises = Array.from(selected).map(cb => ({ name: cb.value, type: cb.dataset.type, start: 0, end: 0 }));
        generateProgressionInputs();
        showStep('progression-step');
    });
    function generateProgressionInputs() {
        const container = document.getElementById('progression-inputs');
        container.innerHTML = '';
        const defaultValues = { 'Plank': [20, 180], 'Crunches': [15, 135], 'Leg Raises': [5, 65], 'Squats': [30, 90] };
        config.exercises.forEach((ex, index) => {
            const defaults = defaultValues[ex.name] || [ex.type === 'timed' ? 20 : 10, ex.type === 'timed' ? 120 : 50];
            const group = document.createElement('div');
            group.className = 'progression-input-group';
            group.innerHTML = `<label for="ex-start-${index}">${ex.name}</label>
                <input type="number" id="ex-start-${index}" placeholder="Start" value="${defaults[0]}">
                <span>&rarr;</span>
                <input type="number" id="ex-end-${index}" placeholder="Einddoel" value="${defaults[1]}">`;
            container.appendChild(group);
        });
    }
    document.getElementById('progression-submit').addEventListener('click', () => {
        config.exercises.forEach((ex, index) => {
            ex.start = parseInt(document.getElementById(`ex-start-${index}`).value, 10) || 0;
            ex.end = parseInt(document.getElementById(`ex-end-${index}`).value, 10) || 0;
        });
        showStep('style-step');
    });
    document.getElementById('finish-setup').addEventListener('click', () => {
        config.progressionStyle = document.querySelector('input[name="progression-style"]:checked').value;
        localStorage.setItem('wc_config', JSON.stringify(config));
        startApp();
    });

    // === PROGRESSIE & DATA GENERATIE ===
    const easingFunctions = {
        rustig: t => t * t, // easeInQuad
        gemiddeld: t => t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2, // easeInOutQuad
        snel: t => 1 - (1 - t) * (1 - t) // easeOutQuad
    };

    function generateChallengeData() {
        challengeData = [];
        const restDays = new Set();
        if (config.restDayInterval > 0) {
            for (let i = config.restDayInterval; i < config.duration; i += config.restDayInterval) {
                restDays.add(i);
            }
        }
        const totalWorkoutDays = config.duration - restDays.size;
        let workoutDayCounter = 0;
        const easingFunc = easingFunctions[config.progressionStyle] || easingFunctions.gemiddeld;

        for (let i = 1; i <= config.duration; i++) {
            const isRest = restDays.has(i);
            const dayObj = { day: i, rust: isRest, tasks: [] };
            if (!isRest) {
                config.exercises.forEach(ex => {
                    const progressFraction = totalWorkoutDays > 1 ? workoutDayCounter / (totalWorkoutDays - 1) : 1;
                    const easedFraction = easingFunc(progressFraction);
                    const idealValue = ex.start + (ex.end - ex.start) * easedFraction;
                    const value = Math.round(idealValue / 5) * 5; 
                    dayObj.tasks.push({ name: ex.name, type: ex.type, value: value });
                });
                workoutDayCounter++;
            }
            challengeData.push(dayObj);
        }
    }

    // === APP-BREDE FUNCTIES ===
    async function toggleWakeLock(button) {
        if (wakeLock) {
            await wakeLock.release();
            wakeLock = null;
            if(button) button.textContent = "Start Workout Modus";
        } else {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                if(button) button.textContent = "✅ Workout Modus Actief";
                wakeLock.addEventListener('release', () => { wakeLock = null; if(button) button.textContent = "Start Workout Modus"; });
            } catch (e) { alert("Wake Lock wordt niet ondersteund."); }
        }
    }
    function startTimer(displayElement, seconds) {
        let time = seconds;
        displayElement.textContent = `⏳ ${time}s`;
        const interval = setInterval(() => {
            time--;
            displayElement.textContent = `⏳ ${time}s`;
            if (time <= 0) { clearInterval(interval); displayElement.textContent = "✅ Klaar!"; document.getElementById("beep-sound").play(); }
        }, 1000);
    }
    function resetApp() {
      if (confirm("Weet je zeker dat je de hele challenge en je configuratie wilt wissen?")) {
        const savedConfigData = localStorage.getItem('wc_config');
        if (savedConfigData) {
            const savedConfig = JSON.parse(savedConfigData);
            const duration = savedConfig.duration || 100;
            for (let i = 1; i <= duration; i++) { localStorage.removeItem(`wc_day_${i}`); }
        }
        localStorage.removeItem('wc_config');
        location.href = location.pathname;
      }
    }

    // === VIEW RENDERING & NAVIGATIE ===
    function renderCalendar() {
        calendarView.innerHTML = '';
        challengeData.forEach(dayData => {
            const dayLink = document.createElement('a');
            dayLink.href = `#day-${dayData.day}`;
            dayLink.className = 'calendar-day';
            if (dayData.rust) {
                dayLink.classList.add('rest-day');
                dayLink.innerHTML = `<span>${dayData.day}</span><span style="font-size:0.5em;">Rust</span>`;
            } else {
                dayLink.textContent = dayData.day;
            }
            if (localStorage.getItem(`wc_day_${dayData.day}`) === 'true') dayLink.classList.add('completed');
            calendarView.appendChild(dayLink);
        });
    }
    function renderDetailView(dayNumber) {
        const dayData = challengeData[dayNumber - 1];
        detailView.innerHTML = ''; 

        const backButton = document.createElement('a');
        backButton.href = '#';
        backButton.className = 'back-button';
        backButton.innerHTML = '← Terug naar overzicht';
        detailView.appendChild(backButton);

        const card = document.createElement('div');
        card.className = 'day-detail-card';
        const isCompleted = localStorage.getItem(`wc_day_${dayNumber}`) === 'true';
        if(isCompleted) card.classList.add('completed');

        let contentHTML = `<div class="day-content"><strong>Dag ${dayNumber}</strong>`;
        card.innerHTML = contentHTML;

        const wakeBtn = document.createElement('button');
        if (!dayData.rust) {
            wakeBtn.className = 'btn workout-modus-btn';
            wakeBtn.textContent = "Start Workout Modus";
            wakeBtn.onclick = () => toggleWakeLock(wakeBtn);
            card.appendChild(wakeBtn);
        }

        let taskListHTML = '<ul>';
        if(dayData.rust) {
            taskListHTML += '<li>Rustdag 🧘‍♀️</li>';
        } else {
            dayData.tasks.forEach((task, index) => {
                taskListHTML += `<li>${task.name}: <strong>${task.value} ${task.type === 'timed' ? 'sec' : 'reps'}</strong>`;
                if (task.type === 'timed') {
                    taskListHTML += ` <button class="timer-button" onclick="startTimer(document.getElementById('timer-span-${index}'), ${task.value})">Start</button><span class="timer" id="timer-span-${index}"></span>`;
                }
                taskListHTML += `</li>`;
            });
        }
        taskListHTML += '</ul>';
        const taskListDiv = document.createElement('div');
        taskListDiv.innerHTML = taskListHTML;
        card.appendChild(taskListDiv);
        
        const completeBtn = document.createElement('button');
        completeBtn.className = 'btn complete-button';
        
        const updateButtonState = (completed) => {
            if (completed) { card.classList.add('completed'); completeBtn.classList.add('done'); completeBtn.textContent = '✅ Voltooid!';
            } else { card.classList.remove('completed'); completeBtn.classList.remove('done'); completeBtn.textContent = 'Markeer als voltooid'; }
        };

        completeBtn.onclick = async () => {
            const current = localStorage.getItem(`wc_day_${dayNumber}`) === 'true';
            const newState = !current;
            if (newState) localStorage.setItem(`wc_day_${dayNumber}`, 'true');
            else localStorage.removeItem(`wc_day_${dayNumber}`);
            updateButtonState(newState);

            if (newState && wakeLock) { await toggleWakeLock(wakeBtn); }
        };

        updateButtonState(isCompleted);
        card.appendChild(completeBtn);
        detailView.appendChild(card);
    }
    function router() {
        const hash = location.hash;
        if (hash.startsWith('#day-')) {
            const dayNumber = parseInt(hash.substring(5), 10);
            calendarView.style.display = 'none'; appControls.style.display = 'none'; detailView.style.display = 'block';
            renderDetailView(dayNumber);
        } else {
            calendarView.style.display = 'grid'; appControls.style.display = 'block'; detailView.style.display = 'none';
            renderCalendar();
        }
    }

    // === INITIALISATIE ===
    function startApp() {
        setupContainer.style.display = 'none';
        appContainer.style.display = 'block';
        document.querySelector('.welcome-message').textContent = `Zet 'm op, ${config.userName}!`;
        generateChallengeData();
        document.getElementById('reset-btn').addEventListener('click', resetApp);
        window.addEventListener('hashchange', router);
        router();
    }
    function init() {
        const savedConfig = localStorage.getItem('wc_config');
        if (savedConfig) {
            config = JSON.parse(savedConfig);
            startApp();
        } else {
            appContainer.style.display = 'none';
            setupContainer.style.display = 'block';
            showStep('name-step');
        }
    }

    init();
  </script>
</body>
</html>
