<!DOCTYPE html>
<html lang="nl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
  <title>WC - Workout Challenge</title>
  
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="WC">
  <link rel="apple-touch-icon" href="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAwCAYAAABXAvmHAAAAAXNSR0IArs4c6QAAAf5JREFUaEPtmO1RAzEMhGMXYBTgKOAowCnAKMAowCnAKMAowCiAAuL5JHvptD5I0qT0Sb5kS2p/d/b3fQBeALsAewB7gB3ACeAB8AY4AzwDngAssAecAS7AExiB/xN4AuwD7AGeATOAPcAG8AR4ArQAfh8ALgeQ1wHkegA5fQE8fQEkfQEsfQFYfQFYfQHkegA5XQEEfQEEfQGcfQFcfQEkfQEkfQGcfQHkegA5nQEEfQFEfQFEfQHcfQFkfQEkfQHcfQGkegA5/QE8fQEkfQFcfQHEegA5vQGcfQHEegA5vQGcfQHEegA5XQEEfQFEfQGEegA5vQGcfQHEegA5vQGEegA5vQGcfQHEegA5XQEEfQFEfQGEegA5vQGcfQHEegA5vQGkegA5/QFkfQGcfQHEegA5/QGcfQHEegA5/QGcfQHEegA5vQGEegA5vQGcfQHEegA5vQGEegA5vQGcfQHEegA5XQEEfQFEfQGkegA5vQGcfQHEegA5XQGkfQEkfQHkegA5/QGcfQFkfQGcfQHEegA5vQGcfQGkfQGEegA5vQGkfQEkfQHkegA5vQGcfQHEegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QGkegA5/QFk/gD+8Y+4A4kX/zG/3wA2gBfAG+AC8AX4A/yr/A+MAFYAzwBngBvAF+AN8AY4A3wBngCfgT/K5wDYP8wD4A3wBjgD/Gv8DwACWAKbAQ4A5wBngDPAucAd4A5wB3gB3gDvgD/An+F/iP88a8A0wB3gD3AHOAO8AewB7gB3gDnAHeAPcAY7APgDJL/8B63AZz2VsjBwAAAAASUVORK5CYII=">

  <style>
    :root {
      --bg-color: #f2f2f2;
      --text-color: #333;
      --card-bg-color: white;
      --card-shadow: 0 2px 5px rgba(0,0,0,0.1);
      --input-border-color: #ccc;
      --completed-day-color: #28a745;
      --completed-bg-color: #d4edda;
      --compliment-color: #155724;
      --button-primary-bg: #007bff;
      --button-primary-hover-bg: #0056b3;
      --button-tertiary-bg: #6c757d;
      --button-tertiary-hover-bg: #5a6268;
      --button-danger-bg: #dc3545;
      --button-danger-hover-bg: #c82333;
      --button-wake-bg: #fff799;
    }
    @media (prefers-color-scheme: dark) {
      :root {
        --bg-color: #121212;
        --text-color: #e0e0e0;
        --card-bg-color: #1e1e1e;
        --card-shadow: 0 2px 8px rgba(0,0,0,0.4);
        --input-border-color: #444;
        --completed-day-color: #3b8e4e;
        --completed-bg-color: #2a3d30;
        --compliment-color: #a7d7b6;
        --button-primary-bg: #0059b3;
        --button-primary-hover-bg: #00448a;
        --button-tertiary-bg: #4f565c;
        --button-tertiary-hover-bg: #3a4045;
        --button-danger-bg: #c82333;
        --button-danger-hover-bg: #a71d2a;
        --button-wake-bg: #5a5229;
      }
    }
    body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background: var(--bg-color); color: var(--text-color); padding: 10px; margin: 0; }
    h1, h2, h3 { text-align: center; }
    h1 { font-size: 1.6em; margin: 5px 0; }
    h2.welcome-message { font-size: 1.2em; font-weight: normal; margin: 0 0 20px; }
    footer { text-align: center; margin: 30px 0 20px; font-size: 0.8em; color: var(--text-color); opacity: 0.6; }
    .intro-text { text-align: center; font-size: 0.95em; max-width: 600px; margin: 0 auto 20px; opacity: 0.8; }
    .warning { text-align: center; font-size: 0.95em; color: #b33; margin-bottom: 5px; font-style: italic; }
    
    /* Setup Wizard Styling */
    .setup-container { padding: 20px; max-width: 500px; margin: auto; }
    .setup-step { background: var(--card-bg-color); padding: 25px; border-radius: 12px; box-shadow: var(--card-shadow); margin-bottom: 20px; }
    .setup-step h3 { margin-top: 0; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: bold; }
    input[type="text"], input[type="number"] { width: 100%; padding: 10px; border-radius: 8px; border: 1px solid var(--input-border-color); box-sizing: border-box; font-size: 1em; background-color: var(--card-bg-color); color: var(--text-color); }
    .btn { display: inline-block; width: 100%; text-align:center; padding: 12px 16px; font-size: 1em; font-weight: bold; border: none; border-radius: 8px; cursor: pointer; color: white; text-decoration: none; }
    .setup-step .btn { background-color: var(--button-primary-bg); }
    .setup-step .btn:hover { background-color: var(--button-primary-hover-bg); }
    .checkbox-group label, .radio-group label { display: flex; align-items: center; margin-bottom: 10px; }
    .checkbox-group input, .radio-group input { margin-right: 10px; transform: scale(1.3); }
    .radio-option { display: flex; align-items: flex-start; margin-bottom: 20px; }
    .radio-option input[type="radio"] { margin-top: 3px; margin-right: 12px; flex-shrink: 0; transform: scale(1.4); }
    .radio-option label strong { font-size: 1.1em; }
    .radio-option label small { display: block; font-weight: normal; opacity: 0.8; margin-top: 2px; }
    .progression-input-group { display: grid; grid-template-columns: 1fr auto auto; gap: 10px; align-items: center; margin-bottom:10px;}
    .progression-input-group label { grid-column: 1 / -1; }
    .progression-input-group input { width: 80px; text-align: center; }

    /* App View Styling & Button Fixes */
    .app-controls { text-align: center; margin-top: 20px; }
    .button-group { display: flex; flex-wrap: wrap; justify-content: center; gap: 10px; }
    .btn.feedback-button { background-color: var(--button-primary-bg); }
    .btn.feedback-button:hover { background-color: var(--button-primary-hover-bg); }
    .btn.reset-button { background-color: var(--button-danger-bg); }
    .btn.reset-button:hover { background-color: var(--button-danger-hover-bg); }
    .btn.complete-button { background-color: var(--button-tertiary-bg); }
    .btn.complete-button:hover { background-color: var(--button-tertiary-hover-bg); }
    .btn.complete-button.done { background-color: #28a745; }
    .btn.workout-modus-btn { background-color: var(--button-wake-bg); color: var(--text-color); margin-bottom: 15px; }
    
    /* Kalender Styling */
    #calendar-view { display: grid; grid-template-columns: repeat(auto-fill, minmax(60px, 1fr)); gap: 10px; padding: 10px; max-width: 500px; margin: 20px auto; }
    .calendar-day { display: flex; flex-direction: column; justify-content: center; align-items: center; background: var(--card-bg-color); color: var(--text-color); text-decoration: none; font-weight: bold; font-size: 1.5em; height: 60px; border-radius: 10px; box-shadow: var(--card-shadow); }
    .calendar-day.completed { background-color: var(--completed-day-color); color: white; }
    .calendar-day.rest-day { font-size: 1em; font-style: italic; opacity: 0.8; }
    
    /* Detail Pagina Styling */
    .day-detail-card { background: var(--card-bg-color); border-radius: 12px; padding: 15px 20px; margin: 10px auto; box-shadow: var(--card-shadow); max-width: 600px; transition: background-color 0.3s; }
    .day-detail-card.completed { background-color: var(--completed-bg-color); }
    .day-content { line-height: 1.6; }
    .day-content > strong { font-size: 1.2em; display:block; text-align:center; margin-bottom: 10px;}
    .day-content ul { list-style: none; padding-left: 0; }
    .day-content li { margin-bottom: 10px; font-size: 1.1em; }
    .back-button { display: block; max-width: 600px; margin: 20px auto 10px; text-align: center; color: var(--text-color); text-decoration: none; font-weight: bold; padding: 10px; background: var(--card-bg-color); border-radius: 8px; box-shadow: var(--card-shadow); }
    .timer-button { background-color: var(--button-primary-bg); color: white; padding: 5px 10px; font-size: 0.8em; border-radius: 6px; cursor: pointer; margin-left: 10px; border: none; }
    .timer { display: inline-block; margin-left: 10px; font-weight: bold; }
    .compliment { margin-top: 15px; padding-top: 10px; border-top: 1px solid rgba(128,128,128,0.2); font-style: italic; color: var(--compliment-color); text-align: center; }
  </style>
</head>
<body>
  <h1>WC - Workout Challenge</h1>
  <div class="warning">⚠️ Dit is een persoonlijke tool – niet bedoeld als medisch advies.</div>
  <p class="intro-text">Stel je eigen workout challenge samen en hou je voortgang bij!</p>
  
  <div id="app-container" style="display: none;">
      <h2 class="welcome-message"></h2>
      <main id="view-container">
          <div id="calendar-view"></div>
          <div id="detail-view" style="display: none;"></div>
      </main>
      <div class="app-controls" id="app-controls">
          <div class="button-group">
            <a href="mailto:post.master@me.com?subject=Feedback%20voor%20WC%20App" class="btn feedback-button">Geef Feedback</a>
            <button id="reset-btn" class="btn reset-button">Nieuwe Challenge</button>
          </div>
      </div>
  </div>

  <div id="setup-container" style="display: none;">
      <div class="setup-step" id="name-step">
          <h3>Welkom!</h3>
          <div class="form-group"><label for="user-name">Wat is je naam?</label><input type="text" id="user-name" placeholder="Jouw naam"></div>
          <button id="name-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="duration-step" style="display: none;">
          <h3>Challenge Duur</h3>
          <div class="form-group"><label for="challenge-duration">Hoeveel dagen duurt je challenge?</label><input type="number" id="challenge-duration" value="30" min="1"></div>
          <button id="duration-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="rest-day-step" style="display: none;">
          <h3>Rustdagen</h3>
          <div class="form-group"><label for="rest-day-interval">Neem elke hoeveelste dag een rustdag?</label><input type="number" id="rest-day-interval" value="5" min="0"></div>
          <p style="font-size:0.9em; opacity:0.7;">(Zet op 0 voor geen automatische rustdagen)</p>
          <button id="rest-day-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="exercise-step" style="display: none;">
          <h3>Kies je Oefeningen</h3>
          <div class="form-group checkbox-group" id="default-exercises">
              <label><input type="checkbox" data-type="timed" value="Plank"> Plank</label>
              <label><input type="checkbox" data-type="reps" value="Crunches"> Crunches</label>
              <label><input type="checkbox" data-type="reps" value="Leg Raises"> Leg Raises</label>
              <label><input type="checkbox" data-type="reps" value="Squats"> Squats</label>
          </div>
          <hr>
          <div class="form-group">
              <label for="custom-exercise">Voeg een eigen oefening toe:</label><input type="text" id="custom-exercise" placeholder="Bijv. Push-ups">
              <div class="form-group radio-group" style="margin-top:10px;"><label><input type="radio" name="custom-type" value="reps" checked> Aantal</label><label><input type="radio" name="custom-type" value="timed"> Seconden</label></div>
              <button id="add-exercise-btn" class="btn" style="width: auto; padding: 8px 12px; margin-top: 5px;">Voeg toe</button>
          </div>
          <button id="exercise-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="progression-step" style="display:none;">
          <h3>Stel je Doelen in</h3>
          <p style="font-size:0.9em; opacity:0.7;">De app berekent een slimme opbouw voor je.</p>
          <div id="progression-inputs"></div>
          <button id="progression-submit" class="btn">Volgende</button>
      </div>
      <div class="setup-step" id="style-step" style="display:none;">
          <h3>Kies je Opbouw Stijl</h3>
          <div class="form-group">
              <div class="radio-option">
                  <input type="radio" id="style-gemiddeld" name="progression-style" value="gemiddeld" checked>
                  <label for="style-gemiddeld">
                      <strong>Gemiddeld</strong>
                      <small>Een gebalanceerde opbouw. Ideaal voor een consistente en geleidelijke progressie.</small>
                  </label>
              </div>
              <div class="radio-option">
                  <input type="radio" id="style-rustig" name="progression-style" value="rustig">
                  <label for="style-rustig">
                      <strong>Rustige Start</strong>
                      <small>Perfect om te beginnen. De focus ligt op het opbouwen van een basis, de echte uitdaging komt later.</small>
                  </label>
              </div>
              <div class="radio-option">
                  <input type="radio" id="style-snel" name="progression-style" value="snel">
                  <label for="style-snel">
                      <strong>Snelle Start</strong>
                      <small>Voor wie direct uitgedaagd wil worden. Je maakt snel progressie in het begin.</small>
                  </label>
              </div>
          </div>
          <button id="finish-setup" class="btn">Start mijn Challenge!</button>
      </div>
  </div>
  
  <footer>Mip Studio’s • 2025</footer>
  <audio id="beep-sound" src="https://actions.google.com/sounds/v1/alarms/beep_short.ogg" preload="auto"></audio>

  <script>
    let config = {};
    let challengeData = [];
    let wakeLock = null;

    const firstDayCompliment = "De eerste stap is gezet, {{name}}! Dit is het begin van iets geweldigs.";
    const workoutCompliments = [ "Kijk jou gaan! Die inzet is bewonderenswaardig.", "Jij bent een machine! 🔥", "Spieren van staal in de maak. 💪", "Ga zo door, {{name}}! De resultaten zullen volgen.", "Zelfs je spiegel is onder de indruk. 😎", "Wat een doorzettingsvermogen!", "Je bent sterker dan je denkt. Deze workout was het bewijs.", "Elke rep telt, en jij maakt ze af!", "Je motivatie is aanstekelijk!", "Dit is hoe kampioenen trainen, {{name}}.", "Je hebt de 'ik kan dit niet' fase officieel verlaten.", "Petje af voor deze discipline!", "Vandaag weer een stap dichter bij je doel.", "Fenomenaal werk, {{name}}!", "Die energie! Kunnen we die op fles verkopen?", "Je lichaam zal je dankbaar zijn.", "Consistentie is de sleutel, en jij hebt hem gevonden.", "Je bent een inspiratie!", "Niet te stoppen, dat ben jij!", "Hoppa! Weer een dag geknald.", "De bank is jaloers op je matje.", "Gemaakt voor het zware werk. Respect, {{name}}!", "Voel je die vooruitgang al?", "Alsof het niks is. Klasse!", "BAM! In de boeken.", "Je bent een levend voorbeeld van wilskracht.", "Elke druppel zweet is een medaille.", "Morgen weer een dag? Jij kan niet wachten!", "Je hebt dit. Einde discussie.", "Jouw toewijding is van een ander niveau." ];
    const restDayCompliments = [ "Goed dat je rust pakt, {{name}}. Herstel is key!", "Een rustdag is een slimme zet. Morgen kom je sterker terug!", "Vandaag even opladen. Je hebt het verdiend!", "Discipline is ook weten wanneer je moet rusten. Perfecte timing.", "Geniet van deze pauze, {{name}}. Je consistentie is indrukwekkend!" ];

    const appContainer = document.getElementById('app-container');
    const setupContainer = document.getElementById('setup-container');
    const allSteps = document.querySelectorAll('.setup-step');
    const calendarView = document.getElementById('calendar-view');
    const detailView = document.getElementById('detail-view');
    const appControls = document.getElementById('app-controls');

    function shuffle(array) { for (let i = array.length - 1; i > 0; i--) { const j = Math.floor(Math.random() * (i + 1)); [array[i], array[j]] = [array[j], array[i]]; } return array; }
    function showStep(stepId) { allSteps.forEach(s => s.style.display = 'none'); document.getElementById(stepId).style.display = 'block'; }
    
    // SETUP WIZARD
    document.getElementById('name-submit').addEventListener('click', () => { config.userName = document.getElementById('user-name').value.trim() || 'Anoniem'; showStep('duration-step'); });
    document.getElementById('duration-submit').addEventListener('click', () => { config.duration = parseInt(document.getElementById('challenge-duration').value, 10) || 30; showStep('rest-day-step'); });
    document.getElementById('rest-day-submit').addEventListener('click', () => { config.restDayInterval = parseInt(document.getElementById('rest-day-interval').value, 10); showStep('exercise-step'); });
    document.getElementById('add-exercise-btn').addEventListener('click', () => { const name = document.getElementById('custom-exercise').value.trim(); const type = document.querySelector('input[name="custom-type"]:checked').value; if (name) { const label = document.createElement('label'); label.innerHTML = `<input type="checkbox" data-type="${type}" value="${name}" checked> ${name}`; document.getElementById('default-exercises').appendChild(label); document.getElementById('custom-exercise').value = ''; } });
    document.getElementById('exercise-submit').addEventListener('click', () => { const selected = document.querySelectorAll('#default-exercises input:checked'); if (selected.length === 0) { alert('Kies minstens één oefening.'); return; } config.exercises = Array.from(selected).map(cb => ({ name: cb.value, type: cb.dataset.type, start: 0, end: 0 })); generateProgressionInputs(); showStep('progression-step'); });
    function generateProgressionInputs() { const container = document.getElementById('progression-inputs'); container.innerHTML = ''; const defaultValues = { 'Plank': [20, 180], 'Crunches': [15, 135], 'Leg Raises': [5, 65], 'Squats': [30, 90] }; config.exercises.forEach((ex, index) => { const defaults = defaultValues[ex.name] || [ex.type === 'timed' ? 20 : 10, ex.type === 'timed' ? 120 : 50]; const group = document.createElement('div'); group.className = 'progression-input-group'; group.innerHTML = `<label for="ex-start-${index}">${ex.name}</label><input type="number" id="ex-start-${index}" value="${defaults[0]}"><span>&rarr;</span><input type="number" id="ex-end-${index}" value="${defaults[1]}">`; container.appendChild(group); }); }
    document.getElementById('progression-submit').addEventListener('click', () => { config.exercises.forEach((ex, index) => { ex.start = parseInt(document.getElementById(`ex-start-${index}`).value, 10) || 0; ex.end = parseInt(document.getElementById(`ex-end-${index}`).value, 10) || 0; }); showStep('style-step'); });
    document.getElementById('finish-setup').addEventListener('click', () => { config.progressionStyle = document.querySelector('input[name="progression-style"]:checked').value; localStorage.setItem('wc_config', JSON.stringify(config)); localStorage.setItem('wc_compliments', JSON.stringify(shuffle([...workoutCompliments]))); startApp(); });

    // DATA & PROGRESSIE
    const easingFunctions = { rustig: t => t * t, gemiddeld: t => t < 0.5 ? 2 * t * t : 1 - Math.pow(-2 * t + 2, 2) / 2, snel: t => 1 - (1 - t) * (1 - t) };
    function generateChallengeData() {
        challengeData = []; const restDays = new Set();
        if (config.restDayInterval > 0) { for (let i = config.restDayInterval; i < config.duration; i += config.restDayInterval) { restDays.add(i); } }
        const totalWorkoutDays = config.duration - restDays.size; let workoutDayCounter = 0;
        const easingFunc = easingFunctions[config.progressionStyle] || easingFunctions.gemiddeld;
        for (let i = 1; i <= config.duration; i++) {
            const isRest = restDays.has(i); const dayObj = { day: i, rust: isRest, tasks: [] };
            if (!isRest) {
                config.exercises.forEach(ex => {
                    const progressFraction = totalWorkoutDays > 1 ? workoutDayCounter / (totalWorkoutDays - 1) : 1;
                    const easedFraction = easingFunc(progressFraction);
                    const idealValue = ex.start + (ex.end - ex.start) * easedFraction;
                    const value = Math.max(ex.start, Math.round(idealValue / 5) * 5); 
                    dayObj.tasks.push({ name: ex.name, type: ex.type, value: value });
                });
                workoutDayCounter++;
            }
            challengeData.push(dayObj);
        }
    }

    // APP FUNCTIES
    async function toggleWakeLock(button) {
        if (wakeLock) {
            await wakeLock.release();
        } else {
            try {
                wakeLock = await navigator.wakeLock.request('screen');
                button.textContent = "✅ Workout Modus Actief";
                button.style.backgroundColor = '#28a745';
                wakeLock.addEventListener('release', () => {
                    wakeLock = null;
                    if (button) {
                        button.textContent = "Start Workout Modus";
                        button.style.backgroundColor = ''; // CSS class pakt het weer op
                    }
                });
            } catch (e) {
                alert("Wake Lock wordt niet ondersteund.");
            }
        }
    }
    function startTimer(displayElement, seconds) { let time = seconds; displayElement.textContent = `⏳ ${time}s`; const interval = setInterval(() => { time--; displayElement.textContent = `⏳ ${time}s`; if (time <= 0) { clearInterval(interval); displayElement.textContent = "✅ Klaar!"; document.getElementById("beep-sound").play(); } }, 1000); }
    function resetApp() {
      if (confirm("Weet je zeker dat je de hele challenge en je configuratie wilt wissen?")) {
        const savedConfigData = localStorage.getItem('wc_config');
        if (savedConfigData) { try { const duration = JSON.parse(savedConfigData).duration || 100; for (let i = 1; i <= duration; i++) { localStorage.removeItem(`wc_day_${i}`); } } catch (e) {} }
        localStorage.removeItem('wc_config'); localStorage.removeItem('wc_compliments');
        location.href = location.pathname;
      }
    }
    function getComplimentForDay(dayNumber) {
        if (dayNumber === config.duration) { return `<strong>CHALLENGE VOLTOOID!</strong><br> Wat een absolute eindbaas! ${config.duration} dagen lang discipline en zweet. Je hebt het gehaald, {{name}}. Wees supertrots op jezelf! 🎉`; }
        const dayData = challengeData[dayNumber - 1];
        if (dayData.rust) { return restDayCompliments[Math.floor(Math.random() * restDayCompliments.length)]; }
        const workoutDayIndex = challengeData.slice(0, dayNumber).filter(d => !d.rust).length - 1;
        if (workoutDayIndex === 0) { return firstDayCompliment; }
        const complimentOrder = JSON.parse(localStorage.getItem('wc_compliments'));
        if (!complimentOrder) return "Goed bezig!";
        const index = (workoutDayIndex - 1) % complimentOrder.length;
        return complimentOrder[index];
    }

    // VIEW RENDERING & NAVIGATIE
    function renderCalendar() {
        calendarView.innerHTML = '';
        challengeData.forEach(dayData => {
            const dayLink = document.createElement('a'); dayLink.href = `#day-${dayData.day}`; dayLink.className = 'calendar-day';
            if (dayData.rust) { dayLink.classList.add('rest-day'); dayLink.innerHTML = `<span>${dayData.day}</span><span style="font-size:0.5em;">Rust</span>`; } 
            else { dayLink.textContent = dayData.day; }
            if (localStorage.getItem(`wc_day_${dayData.day}`) === 'true') dayLink.classList.add('completed');
            calendarView.appendChild(dayLink);
        });
    }
    function renderDetailView(dayNumber) {
        const dayData = challengeData[dayNumber - 1]; detailView.innerHTML = ''; 
        const backButton = document.createElement('a'); backButton.href = '#'; backButton.className = 'back-button'; backButton.innerHTML = '← Terug naar overzicht'; detailView.appendChild(backButton);
        const card = document.createElement('div'); card.className = 'day-detail-card';
        const isCompleted = localStorage.getItem(`wc_day_${dayNumber}`) === 'true'; if(isCompleted) card.classList.add('completed');
        
        const contentDiv = document.createElement('div'); contentDiv.className = 'day-content'; contentDiv.innerHTML = `<strong>Dag ${dayNumber}</strong>`; card.appendChild(contentDiv);
        
        const wakeBtn = document.createElement('button');
        if (!dayData.rust) {
            wakeBtn.className = 'btn workout-modus-btn';
            if (wakeLock && !wakeLock.released) {
                wakeBtn.textContent = "✅ Workout Modus Actief"; wakeBtn.style.backgroundColor = '#28a745';
            } else {
                wakeBtn.textContent = "Start Workout Modus";
            }
            wakeBtn.onclick = () => toggleWakeLock(wakeBtn);
            card.appendChild(wakeBtn);
        }

        let taskListHTML = '<ul>';
        if(dayData.rust) { taskListHTML += '<li>Rustdag 🧘‍♀️</li>'; } 
        else {
            dayData.tasks.forEach((task, index) => {
                taskListHTML += `<li>${task.name}: <strong>${task.value} ${task.type === 'timed' ? 'sec' : 'reps'}</strong>`;
                if (task.type === 'timed') { taskListHTML += ` <button class="timer-button" onclick="startTimer(document.getElementById('timer-span-${index}'), ${task.value})">Start</button><span class="timer" id="timer-span-${index}"></span>`; }
                taskListHTML += `</li>`;
            });
        }
        taskListHTML += '</ul>';
        const taskListDiv = document.createElement('div'); taskListDiv.innerHTML = taskListHTML; card.appendChild(taskListDiv);
        
        const completeBtn = document.createElement('button'); completeBtn.className = 'btn complete-button';
        const complimentDiv = document.createElement('div'); complimentDiv.className = 'compliment';
        
        const updateButtonState = (completed) => {
            if (completed) { 
                card.classList.add('completed'); completeBtn.classList.add('done'); completeBtn.textContent = '✅ Voltooid!';
                const complimentText = getComplimentForDay(dayNumber);
                complimentDiv.innerHTML = complimentText.replace(/{{name}}/g, config.userName); complimentDiv.style.display = 'block';
            } else { 
                card.classList.remove('completed'); completeBtn.classList.remove('done'); completeBtn.textContent = 'Markeer als voltooid'; 
                complimentDiv.style.display = 'none';
            }
        };

        completeBtn.onclick = async () => {
            const current = localStorage.getItem(`wc_day_${dayNumber}`) === 'true'; const newState = !current;
            if (newState) localStorage.setItem(`wc_day_${dayNumber}`, 'true'); else localStorage.removeItem(`wc_day_${dayNumber}`);
            updateButtonState(newState);
            if (newState && wakeLock) { await wakeLock.release(); }
        };

        updateButtonState(isCompleted);
        card.appendChild(completeBtn); 
        card.appendChild(complimentDiv);
        detailView.appendChild(card);
    }
    function router() {
        const hash = location.hash;
        if (hash.startsWith('#day-')) {
            const dayNumber = parseInt(hash.substring(5), 10);
            calendarView.style.display = 'none'; appControls.style.display = 'none'; detailView.style.display = 'block';
            renderDetailView(dayNumber);
        } else {
            calendarView.style.display = 'grid'; appControls.style.display = 'block'; detailView.style.display = 'none';
            renderCalendar();
        }
    }
    
    // INITIALISATIE
    function startApp() {
        setupContainer.style.display = 'none'; appContainer.style.display = 'block';
        document.querySelector('.welcome-message').textContent = `Zet 'm op, ${config.userName}!`;
        generateChallengeData();
        document.getElementById('reset-btn').addEventListener('click', resetApp);
        window.addEventListener('hashchange', router); router();
    }
    function init() {
        const savedConfig = localStorage.getItem('wc_config');
        if (savedConfig) { config = JSON.parse(savedConfig); startApp();
        } else { appContainer.style.display = 'none'; setupContainer.style.display = 'block'; showStep('name-step'); }
    }
    init();
  </script>
</body>
</html>
